<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Connecting MYOB ‚Äî ComplianceEase</title>
  <link rel="stylesheet" href="../../css/style.css">
</head>
<body style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:var(--ink-950);">
  <div style="text-align:center;font-family:'Instrument Sans',sans-serif;max-width:400px;padding:40px;">
    <div id="status">
      <div style="font-size:40px;margin-bottom:20px;">üü°</div>
      <h2 style="color:white;font-size:1.4rem;font-weight:700;margin-bottom:8px;">Connecting MYOB‚Ä¶</h2>
      <p style="color:rgba(255,255,255,.4);font-size:14px;">Loading your company files</p>
      <div style="margin-top:24px;width:40px;height:40px;border:3px solid rgba(255,255,255,.1);border-top-color:#7c3aed;border-radius:50%;animation:spin 1s linear infinite;margin:24px auto 0;"></div>
    </div>
  </div>
  <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const code   = params.get('code');
      const error  = params.get('error');
      const statusEl = document.getElementById('status');

      if (error || !code) {
        statusEl.innerHTML = `<div style="font-size:40px;margin-bottom:20px;">${error ? '‚ùå' : '‚ö†Ô∏è'}</div>
          <h2 style="color:white;">${error ? 'Connection cancelled' : 'No code received'}</h2>
          <a href="../../settings.html" style="display:inline-block;margin-top:20px;padding:10px 20px;background:#7c3aed;color:white;border-radius:10px;text-decoration:none;font-weight:600;">‚Üê Back to Settings</a>`;
        return;
      }

      try {
        // PRODUCTION:
        // const res = await fetch('/api/myob/callback', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code}) });
        // const data = await res.json();

        await new Promise(r => setTimeout(r, 1500));
        const data = { success: true, companyFiles: [{ id: 'demo-cf', name: 'Brown Construction Group' }] };

        statusEl.innerHTML = `<div style="font-size:40px;margin-bottom:20px;">‚úÖ</div>
          <h2 style="color:white;margin-bottom:8px;">MYOB Connected!</h2>
          <p style="color:rgba(255,255,255,.5);font-size:14px;margin-bottom:20px;">${data.companyFiles.length} company file(s)</p>
          <div style="background:rgba(255,255,255,.05);border-radius:10px;padding:16px;margin-bottom:20px;text-align:left;">
            ${data.companyFiles.map(cf => `<div style="color:rgba(255,255,255,.7);font-size:13px;padding:4px 0;">‚úì ${cf.name}</div>`).join('')}
          </div>
          <a href="../../dashboard.html" style="display:inline-block;padding:12px 24px;background:#7c3aed;color:white;border-radius:10px;text-decoration:none;font-weight:600;">Go to Dashboard ‚Üí</a>`;
      } catch(err) {
        statusEl.innerHTML = `<div style="font-size:40px;margin-bottom:20px;">‚ùå</div>
          <h2 style="color:white;">Connection failed</h2>
          <a href="../../settings.html" style="display:inline-block;margin-top:20px;padding:10px 20px;background:#7c3aed;color:white;border-radius:10px;text-decoration:none;font-weight:600;">‚Üê Back to Settings</a>`;
      }
    })();
  </script>
</body>
</html>
